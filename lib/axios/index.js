import{__assign as e}from"../node_modules/tslib/tslib.es6.js";import n from"axios";import a from"../node_modules/qs/lib/index.js";var t=function(){function t(t){var s=this;this.pendingMap=new Map,this.getPendingKey=function(e){var n=e.url,a=e.method,t=e.params,s=e.data;return"string"==typeof s&&(s=JSON.parse(s)),[n,a,JSON.stringify(t),JSON.stringify(s)].join("&")},this.addPending=function(e){var a=s.getPendingKey(e);e.cancelToken=e.cancelToken||new n.CancelToken((function(e){s.pendingMap.has(a)||s.pendingMap.set(a,e)}))},this.removePending=function(e){var n=s.getPendingKey(e);s.pendingMap.has(n)&&(s.pendingMap.get(n)(n),s.pendingMap.delete(n))},this.request=function(n,t,i){void 0===i&&(i={});var r=s,o=r.instance,c=r.axiosConfig,d=c.requestConfig,u=c.timeout,p=c.project,g=c.handleResponseData,m=c.requertDynamicHeader,f=i.config,l=i.headers,h=void 0===l?{}:l,v=i.cancelRepeatRequest,b=function(e,n){var a=e.path,t=e.type,s=n.version,i=void 0===s?"v1":s,r=n.project,o=a;return a.includes("{projectName}")&&r&&(o=a.replace("{projectName}",r)),a.includes("{version}")&&i&&(o=a.replace("{version}",i)),{path:o,type:t}}(n,{project:p}),R=b.path,k=b.type,y=void 0===k?"post":k,q=function(e,n){var a,t,s=e.path,i=n.baseDomainName,r=n.baseHeader,o=n.domainList;if(o)for(var c=0;c<o.length;c++){var d=o[c];if(d.serviceName){var u=d.serviceName.find((function(e){return"string"==typeof e?s.includes(e):s.includes(e.name)}));if(u){"string"==typeof u?(t=d.headerRequest,a=d.domainName):(t=u.header||d.headerRequest,a=d.domainName);break}}}return{baseURL:a||i,header:t||r}}(n,d),P=q.header,N=void 0===P?{}:P,j=q.baseURL,M=m?m():{},w=o.request(e({url:R,baseURL:j,method:y,data:/(post|POST)/.test(y)?t:void 0,params:/(get|GET)/.test(y)?t:void 0,paramsSerializer:function(e){return a.stringify(e,{arrayFormat:"repeat"})},timeout:u,headers:e(e(e(e({},N),M),h),{cancelRepeatRequest:v})},f));return g?new Promise((function(e,n){w.then((function(a){g(a,i,s).then((function(n){e(n)})).catch((function(e){n(e)}))})).catch((function(e){n(e)}))})):w},this.onCancelRequestAll=function(){s.pendingMap.forEach((function(e,n){e(n),s.pendingMap.delete(n)}))},this.axiosConfig=t,this.instance=n.create(),this.init()}return t.prototype.init=function(){var e=this,a=this.axiosConfig.cancelRepeatRequest;this.instance.interceptors.request.use((function(n){var t,s=n.headers.cancelRepeatRequest;return("boolean"!=typeof s||s)&&(void 0!==s||("boolean"!=typeof a||a)&&a)||(e.removePending(n),e.addPending(n)),(null===(t=n.headers)||void 0===t?void 0:t.cancelRepeatRequest)&&delete n.headers.cancelRepeatRequest,n})),this.instance.interceptors.response.use((function(n){return e.removePending(n.config),n}),(function(a){return a.config&&e.removePending(a.config),function(e){var a=e.message,t=e.response;if(t){var s=t.status,i=t.config.url;switch(e.code=s,s){case 302:e.message="接口重定向了！";break;case 400:e.message="参数不正确！";break;case 401:e.message="您未登录，或者登录已经超时，请先登录！";break;case 403:e.message="您没有权限操作！";break;case 404:e.message="请求路径不存在: ".concat(i);break;case 408:e.message="请求超时！";break;case 409:e.message="系统已存在相同数据！";break;case 500:e.message="服务器内部错误！";break;case 501:e.message="服务未实现！";break;case 502:e.message="网关错误！";break;case 503:e.message="服务不可用！";break;case 504:e.message="服务暂时无法访问，请稍后再试！";break;case 505:e.message="HTTP版本不受支持！";break;default:e.message="异常问题，请联系管理员！"}}return a.includes("timeout")&&(e.message="网络请求超时！",e.code=504),a.includes("Network")&&(e.message=window.navigator.onLine?"服务端异常！":"您断网了！",e.code=-7),n.isCancel(e)?Promise.reject(e):e}(a)}))},t}();export{t as default};
//# sourceMappingURL=index.js.map
