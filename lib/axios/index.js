import{__assign as e,__rest as n}from"../node_modules/tslib/tslib.es6.js";import t from"axios";import a from"../node_modules/qs/lib/index.js";var i=function(e,n){var t=e.path,a=e.type,i=n.version,s=void 0===i?"v1":i,o=n.project,r=t;return t.includes("{projectName}")&&o&&(r=t.replace("{projectName}",o)),t.includes("{version}")&&s&&(r=t.replace("{version}",s)),{path:r,type:a}},s=function(){function s(s){var o=this;this.pendingMap=new Map,this.getPendingKey=function(e){var n=e.url,t=e.method,a=e.params,i=e.data;return"string"==typeof i&&(i=JSON.parse(i)),[n,t,JSON.stringify(a),JSON.stringify(i)].join("&")},this.addPending=function(e){var n=o.getPendingKey(e);e.cancelToken=e.cancelToken||new t.CancelToken((function(e){o.pendingMap.has(n)||o.pendingMap.set(n,e)}))},this.removePending=function(e){var n=o.getPendingKey(e);o.pendingMap.has(n)&&(o.pendingMap.get(n)("取消请求:"+n),o.pendingMap.delete(n))},this.request=function(t,s,r){void 0===s&&(s={}),void 0===r&&(r={});var c=o,d=c.instance,u=c.axiosConfig,p=u.requestConfig,m=u.timeout,g=u.project,f=u.handleResponseData,h=u.requertDynamicHeader,v=r.config,l=r.headers,b=void 0===l?{}:l,y=r.cancelRepeatRequest,k=i(t,{project:g}),R=k.path,P=k.type,q=void 0===P?"post":P,N=function(e,t){var a,i,s,o=e.path,r=t.domainAry,c=n(t,["domainAry"]);if(r)for(var d=0;d<r.length;d++){var u=r[d];if(u.serviceName){var p=u.serviceName.find((function(e){return"string"==typeof e?o.includes(e):o.includes(e.name)}));if(p){"string"==typeof p?(i=u.headers,a=u.domainName,s=u.timeout):(i=p.header||u.headers,a=u.domainName,s=p.timeout||u.timeout);break}}}return{baseURL:a||c.domainName,header:i||c.headers,timeout:s}}(t,p),j=N.header,M=void 0===j?{}:j,T=N.baseURL,C=N.timeout,w=h?h():{},x=d.request(e({url:R,baseURL:T,method:q,data:/(post|POST)/.test(q)?s:void 0,params:/(get|GET)/.test(q)?s:void 0,paramsSerializer:function(e){return a.stringify(e,{arrayFormat:"repeat"})},timeout:C||m,headers:e(e(e(e({},M),w),b),{cancelRepeatRequest:y})},v));return f?new Promise((function(e,n){x.then((function(t){f(t,r,o).then((function(n){e(n)})).catch((function(e){n(e)}))})).catch((function(e){n(e)}))})):x},this.unRequest=function(e,n,t){void 0===n&&(n={}),void 0===t&&(t={});var a=o.axiosConfig.project,s=t.config,r=i(e,{project:a}),c=r.path,d=r.type,u=void 0===d?"post":d,p=[void 0,void 0],m=p[0],g=p[1];(/(post|POST)/.test(u)?g=n:/(get|GET)/.test(u)&&(m=n),s)&&(m=s.params||m,g=s.data||g);"string"==typeof g&&(g=JSON.parse(g)),o.removePending({url:c,method:u,params:m,data:g})},this.onCancelRequestAll=function(){o.pendingMap.forEach((function(e,n){e(n),o.pendingMap.delete(n)}))},this.axiosConfig=s,this.instance=t.create(),this.init()}return s.prototype.init=function(){var e=this,n=this.axiosConfig.cancelRepeatRequest;this.instance.interceptors.request.use((function(t){var a,i=t.headers.cancelRepeatRequest;return("boolean"!=typeof i||i)&&(void 0!==i||("boolean"!=typeof n||n)&&n)||(e.removePending(t),e.addPending(t)),(null===(a=t.headers)||void 0===a?void 0:a.cancelRepeatRequest)&&delete t.headers.cancelRepeatRequest,t})),this.instance.interceptors.response.use((function(n){return e.removePending(n.config),n}),(function(n){return n.config&&e.removePending(n.config),function(e){var n=e.message,a=e.response;if(a){var i=a.status,s=a.config.url;switch(e.code=i,i){case 302:e.message="接口重定向了！";break;case 400:e.message="参数不正确！";break;case 401:e.message="您未登录，或者登录已经超时，请先登录！";break;case 403:e.message="您没有权限操作！";break;case 404:e.message="请求路径不存在: ".concat(s);break;case 408:e.message="请求超时！";break;case 409:e.message="系统已存在相同数据！";break;case 500:e.message="服务器内部错误！";break;case 501:e.message="服务未实现！";break;case 502:e.message="网关错误！";break;case 503:e.message="服务不可用！";break;case 504:e.message="服务暂时无法访问，请稍后再试！";break;case 505:e.message="HTTP版本不受支持！";break;default:e.message="异常问题，请联系管理员！"}}return n.includes("timeout")&&(e.message="网络请求超时！",e.code=504),n.includes("Network")&&(e.message=window.navigator.onLine?"服务端异常！":"您断网了！",e.code=-7),t.isCancel(e)?Promise.reject(e):e}(n)}))},s}();export{s as default};
//# sourceMappingURL=index.js.map
